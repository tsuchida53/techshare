<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
    "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.rugbyaholic.techshare.common.UserRepository">
	
	<select id="identifyUser" parameterType="java.lang.String" resultMap="userDetails">
	<![CDATA[
		SELECT  
				a.ID,
				a.EMAIL,
				a.AVF,
				a.NAME,
				a.PASSWORD,
				a.LOCKED,
				a.EXPIRED,
				b.ROLE,
				c.CODE_NM
FROM  	USERS a

inner JOIN	
	USER_ROLES b
ON     b.USER_ID = a.ID

left JOIN	 
	CODEMST c
ON     c.CODE_ID   = 1
AND    b.role   =   c.CODE	
where	 a.EMAIL       = #{email} 
	]]>	
	</select>
	
	<resultMap type="com.rugbyaholic.techshare.auth.AuthenticatedUser" id="userDetails">
		<result property="id" column="ID" />
		<result property="email" column="EMAIL" />
		<result property="avf" column="AVF" />
		<result property="username" column="NAME" />
		<result property="password" column="PASSWORD" />
		<result property="locked" column="LOCKED" />
		<result property="expired" column="EXPIRED" />
		<collection property="roles" ofType="java.lang.String">
			<result column="CODE_NM" />
		</collection>
	</resultMap>
	
</mapper>